% Main file

%==========================================================================
%  Document Definition
%--------------------------------------------------------------------------
\documentclass[10pt,a4paper]{article}
%==========================================================================

%==========================================================================
% Include Used Packages
%--------------------------------------------------------------------------
\usepackage[utf8]{inputenc}		        	% Keybord settings
\usepackage{titlesec}						% for vertical alignment of (sub-)section titles and title spacing
\usepackage{setspace}						% for line spacing
\usepackage{amsmath}                 		% Additional math functionality
\usepackage{amssymb}						% Additional math symbols
\usepackage[english]{babel}					% for hyphenation and special caracters
\usepackage{graphicx}						% for including images

\usepackage{pst-pdf}						% for latex to pdf
\usepackage{pst-eucl}						% for latex to ps
\usepackage{pst-text}						% for latex to ps
\usepackage{pstricks}						% for inkScape files; for latex to ps

\usepackage{listings}

% Always the last package:
\usepackage[breaklinks]{hyperref}			% Hyperreferenzen f√ºr pdf
%==========================================================================

%==========================================================================
% Font
%--------------------------------------------------------------------------
\usepackage[T1]{fontenc}					% font encoding
\usepackage{lmodern}						% font
\renewcommand*\familydefault{\sfdefault}	% Only if the base font of the document is to be sans serif
%==========================================================================

%==========================================================================
% Include modified and customized Commands
%--------------------------------------------------------------------------
% Paragraph with \newline
\titleformat{\paragraph}[display]{\normalfont\bf\normalsize}{\theparagraph}{-2em}{}[]
% No indent after new paragraph
\setlength{\parindent}{0pt}
% Change vertical spacing between paragraphs
\setlength{\parskip}{5pt}
%==========================================================================

%==========================================================================
% Document Infos
%--------------------------------------------------------------------------
\title {Spec}
\author {Dominique Hunziker}

\hypersetup{
	pdftitle={Diagram},
	pdfauthor={Dominique Hunziker},
	pdfsubject={Specification of WebService}}
%==========================================================================

%==========================================================================
% Line Spacing
%--------------------------------------------------------------------------
\onehalfspacing
%==========================================================================

%==========================================================================
% Title Spacing
%--------------------------------------------------------------------------
\titlespacing{\section}{0pt}{10pt}{5pt}
\titlespacing{\subsection}{0pt}{8pt}{4pt}
\titlespacing{\subsubsection}{0pt}{6pt}{0pt}
\titlespacing{\paragraph}{0pt}{6pt}{-2pt}
%==========================================================================

%==========================================================================
% Document Content
%--------------------------------------------------------------------------
\begin{document}
	\section*{Motivation}
		\textsc{ToDo}
	
	\section*{Approach}
		The task of the framework is to offer an interface for arbitrary apps to other users.
		Therefore, the framework has to provide a possibility to interact, i.e. create, select
		use, the apps. This means that the framework acts as a manager of the apps and interpreter
		between the user and apps. As the apps are typically a process the framework essentially
		has to manage and communicate with them. As the basic interface between the apps and the
		framework we propose the usage of \textsc{ROS} as motivated above. It allows simple management
		of processes using \emph{roslaunch} and has a standardized language to communicate between
		processes. As a first implementation we focused on the usage of \emph{nodes} which provide
		\emph{services} as apps. \\
		On the other end of the framework it has to communicate with the users who want to use the
		apps. To include a broader audience the interaction uses the standard \textsc{http} protocol.
		This allows users who do not run \textsc{ROS} and it would be possible to use the apps from
		a web browser. This can be achieved by using the framework as a web server. For the first
		implementation the focus is on the robots as users and, therefore, an API is necessary. For
		this task \emph{django}/\emph{piston} is used.
	
	\section*{Specification}
		The specification for the development of apps in the current stage of the framework is, as
		mentioned above, that it has to be a \textsc{ROS} \emph{node} which provides a
		\emph{service} which can be used by the user. Besides that no further restrictions are
		necessary. \\
		For the communication between the user and the framework the \emph{http} protocol is used.
		Here the request types \textsc{GET}, \textsc{POST} and \textsc{DELETE} are used. To further
		distinguish and control the interaction dynamic URL are used. Using this leads basically to
		three levels, i.e. \emph{Service}, \emph{Environment} and \emph{Task}, which leads to the
		following URL pattern
		\begin{lstlisting}
BASE/api/reappengine/[envID/[taskID/[fileRef/]]]
		\end{lstlisting}
		The level \emph{Service} represents the entry point for a new user. The first step is to
		create a new environment which essentially creates a new \emph{namespace} in \textsc{ROS}.
		Also on this level the user can add or remove \emph{nodes} from his environment.
		Furthermore, some general information is available. \\
		On the next level the user can create a task which is essentially the input message for
		the selected \textsc{ROS} \emph{service}. Again, he can get some information specific to
		his current environment. \\
		And on the last level the user can retrieve the status or, if the task has been completed
		successfully, the result of a task. The forth level \emph{fileRef} is only used to provide
		the possibility to download referenced files for the tasks result, i.e. an image file. The
		result is basically the response message of the selected service. \\
		To exchange the data needed for all these requests the \textsc{json} format is used. As
		the requests which create a new environment/node or task are implemented with as a
		\textsc{POST} it is also possible to send files. To simplify the construction requests and
		interpretation of the responses a small ServiceAPI is available. For a graphical
		representation of these interactions refer to figure \ref{fig:diagram}. 
		
		\begin{figure}
			\begin{center}
				\input{diagram.tex}
				\caption{Organization of the framework (loosely from top to bottom): The client,
				which can use the provided \emph{ServiceAPI}, communicates with the
				\emph{DjangoInterface} over \textsc{http} The \emph{DjangoInterface} than uses the
				necessary \emph{services} of the \emph{ServerNode} or \emph{EnvironmentNode} (solid
				arrows). The \emph{EnvironmentNode} is created and managed by the \emph{ServerNode}
				(dashed arrow). The user selected app-\emph{nodes} are than launched and managed by
				the \emph{EnvironmentNode} (dashed arrow) which also provides the necessary
				\emph{services} to create tasks and retrieve their results (solid arrow).}
				\label{fig:diagram}
			\end{center}
		\end{figure}

\end{document}
%==========================================================================
